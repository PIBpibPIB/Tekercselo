unit TImer;
uses
  Rotary,
  Feedrate,
  Declarations;

const
  PRELOADHI   = 208;
  PRELOADLO   = 42;
  TICKSperSEC = 1000;
  
procedure InitTimer;
procedure Buttons_interrupt; external;

implementation

//------------------------------------------------------------------------------
procedure InitTimer;
begin
  T3CON        := 0;

  TMR3H      := PRELOADHI;
  TMR3L      := PRELOADLO;
  
  PIR2.TMR3IF  := 1;
  PIE2.TMR3IE  := 1;
  dwTicks      := 0;

  T3CON.TMR3ON := 1;
end;
//------------------------------------------------------------------------------
procedure Interrupt;
var
  i         : byte;
  k         : byte;
begin
  if (TMR3IF_bit) then
  begin
    TMR3H      := PRELOADHI;
    TMR3L      := PRELOADLO;
    TMR3IF_bit := 0;
    
    inc(dwTicks);

    //Rotary
    Rotary_interrupt;

    //Buttons
    Buttons_interrupt;

    //Step motor pulses
    StepMotor_interrupt;
  end;
end;
//------------------------------------------------------------------------------
end.
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------